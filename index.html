<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Protocol</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500;600;700&family=Manrope:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0b0b0e;
    --card: rgba(255,255,255,0.028);
    --line: rgba(255,255,255,0.06);
    --white: #f5f3f0;
    --soft: rgba(245,243,240,0.6);
    --muted: rgba(245,243,240,0.25);
    --lime: #c8fb45;
    --lime10: rgba(200,251,69,0.1);
    --sky: #6cb4ff;
    --sky10: rgba(108,180,255,0.08);
    --peach: #ffa26b;
    --peach10: rgba(255,162,107,0.08);
    --lav: #c9a0ff;
    --lav10: rgba(201,160,255,0.08);
    --rose: #ff7b7b;
    --rose10: rgba(255,123,123,0.08);
    --off-bg: rgba(255,123,123,0.06);
    --off-border: rgba(255,123,123,0.12);
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html { background: var(--bg); color: var(--white); font-family: 'Manrope', system-ui, sans-serif; -webkit-font-smoothing: antialiased; }
  body { max-width: 460px; margin: 0 auto; padding-bottom: 80px; }

  header { padding: 60px 28px 0; text-align: center; }
  .eyebrow { font-family: 'JetBrains Mono', monospace; font-size: 9px; font-weight: 500; letter-spacing: 6px; text-transform: uppercase; color: var(--lime); margin-bottom: 12px; }
  header h1 { font-family: 'Cormorant Garamond', serif; font-size: 40px; font-weight: 600; line-height: 1; letter-spacing: -1px; }
  .kpis { display: flex; justify-content: center; gap: 28px; margin-top: 26px; }
  .kpi b { display: block; font-family: 'JetBrains Mono', monospace; font-size: 22px; font-weight: 500; line-height: 1; }
  .kpi small { font-size: 9px; font-weight: 600; letter-spacing: 2px; text-transform: uppercase; color: var(--muted); margin-top: 5px; display: block; }
  .v-lime { color: var(--lime); }
  .v-rose { color: var(--rose); }
  .v-sky { color: var(--sky); }
  .v-peach { color: var(--peach); }

  /* ══════════ TABS ══════════ */
  .tabs { display: flex; margin: 0 28px; gap: 0; border-bottom: 1px solid var(--line); }
  .tab { flex: 1; padding: 14px 0; text-align: center; font-family: 'JetBrains Mono', monospace; font-size: 11px; font-weight: 500; letter-spacing: 2px; text-transform: uppercase; color: var(--muted); cursor: pointer; border-bottom: 2px solid transparent; transition: color 0.2s, border-color 0.2s; position: relative; top: 1px; -webkit-tap-highlight-color: transparent; }
  .tab:active { opacity: 0.5; }
  .tab.active { color: var(--lime); border-bottom-color: var(--lime); }
  .tab-content { display: none; }
  .tab-content.active { display: block; }

  .banner { margin: 16px 28px 0; padding: 14px 16px; border-radius: 12px; font-size: 13px; line-height: 1.6; font-weight: 500; display: none; }
  .banner.show { display: block; }
  .banner-off { background: var(--off-bg); border: 1px solid var(--off-border); color: var(--rose); }
  .banner-info { background: var(--lime10); border: 1px solid rgba(200,251,69,0.12); color: var(--lime); }
  .banner-sky { background: var(--sky10); border: 1px solid rgba(108,180,255,0.12); color: var(--sky); }
  .banner strong { font-weight: 700; }
  .banner-sub { font-size: 11px; font-weight: 400; color: var(--soft); margin-top: 4px; }

  .block { padding: 24px 28px; border-bottom: 1px solid var(--line); }
  .block:last-of-type { border-bottom: none; }
  .block-head { display: flex; align-items: center; gap: 12px; margin-bottom: 14px; }
  .block-hour { font-family: 'JetBrains Mono', monospace; font-size: 13px; font-weight: 500; color: var(--lime); min-width: 52px; flex-shrink: 0; }
  .block-title { font-size: 18px; font-weight: 700; letter-spacing: -0.3px; line-height: 1.2; }
  .items { padding-left: 64px; display: grid; gap: 6px; }
  .items-flat { padding-left: 0; display: grid; gap: 6px; }
  .item { font-size: 14.5px; font-weight: 400; color: var(--soft); line-height: 1.6; display: flex; align-items: baseline; gap: 8px; }
  .item::before { content: '\00b7'; color: var(--muted); font-weight: 800; font-size: 18px; line-height: 1; flex-shrink: 0; }
  .item-em { color: var(--white); font-weight: 600; }
  .item-warn { color: var(--rose); }

  .item-supp { font-size: 14px; font-weight: 600; color: var(--lime); padding: 8px 12px; background: var(--lime10); border-radius: 10px; margin: 4px 0; line-height: 1.5; }
  .item-supp.supp-pm { color: var(--sky); background: var(--sky10); }
  .item-supp.supp-night { color: var(--lav); background: var(--lav10); }
  .item-supp.supp-peach { color: var(--peach); background: var(--peach10); }
  .item-supp .supp-detail { font-weight: 400; font-size: 12px; color: var(--soft); display: block; }
  .supp-hidden { display: none !important; }

  .macros { padding-left: 64px; display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }
  .tag { font-family: 'JetBrains Mono', monospace; font-size: 11px; font-weight: 500; padding: 4px 10px; border-radius: 7px; }
  .t-k { background: var(--lime10); color: var(--lime); }
  .t-p { background: var(--sky10); color: var(--sky); }
  .t-g { background: var(--peach10); color: var(--peach); }
  .t-l { background: var(--lav10); color: var(--lav); }

  .block-simple { padding: 16px 28px; border-bottom: 1px solid var(--line); display: flex; align-items: center; gap: 12px; }
  .block-simple .block-hour { color: var(--muted); }
  .block-simple .block-title { font-size: 15px; font-weight: 500; color: var(--soft); }

  .totals { margin: 28px 28px 0; padding: 22px; border-radius: 16px; background: var(--card); border: 1px solid var(--line); display: grid; grid-template-columns: repeat(4, 1fr); text-align: center; gap: 8px; }
  .tval { font-family: 'JetBrains Mono', monospace; font-size: 19px; font-weight: 500; }
  .c1 { color: var(--lime); } .c2 { color: var(--sky); } .c3 { color: var(--peach); } .c4 { color: var(--lav); }
  .tlbl { font-size: 9px; font-weight: 600; letter-spacing: 1.5px; text-transform: uppercase; color: var(--muted); margin-top: 4px; }
  .tcheck { font-size: 10px; color: var(--lime); font-weight: 500; margin-top: 2px; }

  .cycle-status { margin: 24px 28px 0; padding: 18px; border-radius: 14px; background: var(--card); border: 1px solid var(--line); }
  .cycle-title { font-family: 'JetBrains Mono', monospace; font-size: 9px; letter-spacing: 3px; text-transform: uppercase; color: var(--muted); margin-bottom: 14px; }
  .cycle-row { display: flex; align-items: center; justify-content: space-between; padding: 8px 0; }
  .cycle-row + .cycle-row { border-top: 1px solid var(--line); }
  .cycle-name { font-size: 14px; font-weight: 600; }
  .cycle-badge { font-family: 'JetBrains Mono', monospace; font-size: 11px; font-weight: 500; padding: 4px 10px; border-radius: 7px; }
  .cb-on { background: var(--lime10); color: var(--lime); }
  .cb-off { background: var(--rose10); color: var(--rose); }
  .cycle-detail { font-size: 11px; color: var(--muted); margin-top: 2px; }

  .links { margin: 24px 28px 0; display: grid; gap: 10px; }
  .link-card { display: flex; align-items: center; justify-content: space-between; padding: 16px 18px; border-radius: 14px; background: var(--card); border: 1px solid var(--line); text-decoration: none; transition: opacity 0.15s; }
  .link-card:active { opacity: 0.6; }
  .link-info h4 { font-size: 14px; font-weight: 700; color: var(--white); margin-bottom: 2px; }
  .link-info p { font-size: 12px; color: var(--muted); }
  .link-price { font-family: 'JetBrains Mono', monospace; font-size: 13px; font-weight: 500; flex-shrink: 0; }
  .link-card.lc-am .link-price { color: var(--lime); }

  .notes-head { padding: 36px 28px 14px; font-family: 'JetBrains Mono', monospace; font-size: 9px; letter-spacing: 4px; text-transform: uppercase; color: var(--muted); }
  .note { margin: 0 28px 10px; padding: 14px 16px; border-radius: 12px; background: var(--card); border: 1px solid var(--line); font-size: 13px; line-height: 1.65; color: var(--soft); }
  .note strong { color: var(--white); font-weight: 700; }
  .note b { color: var(--lime); font-weight: 600; }

  .settings-toggle { display: block; margin: 32px auto 0; padding: 10px 20px; background: transparent; border: 1px solid var(--line); border-radius: 10px; color: var(--muted); font-family: 'JetBrains Mono', monospace; font-size: 11px; letter-spacing: 1px; cursor: pointer; }
  .settings-toggle:active { opacity: 0.5; }
  .settings-panel { margin: 16px 28px 0; padding: 20px; border-radius: 14px; background: var(--card); border: 1px solid var(--line); display: none; }
  .settings-panel.show { display: block; }
  .settings-panel label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 6px; color: var(--soft); }
  .settings-panel input[type="date"] { width: 100%; padding: 10px 14px; border-radius: 10px; border: 1px solid var(--line); background: var(--bg); color: var(--white); font-family: 'JetBrains Mono', monospace; font-size: 14px; margin-bottom: 16px; -webkit-appearance: none; }
  .settings-panel .hint { font-size: 11px; color: var(--muted); margin-bottom: 16px; line-height: 1.5; }
  .btn-save { width: 100%; padding: 12px; border-radius: 10px; border: none; background: var(--lime); color: var(--bg); font-family: 'Manrope', sans-serif; font-size: 14px; font-weight: 700; cursor: pointer; }
  .btn-save:active { opacity: 0.7; }

  /* ══════════ HAIR TAB — WEEKLY TABLE ══════════ */
  .week-table { margin: 0 28px; border-radius: 14px; overflow: hidden; border: 1px solid var(--line); }
  .week-table table { width: 100%; border-collapse: collapse; font-size: 11px; }
  .week-table th { font-family: 'JetBrains Mono', monospace; font-size: 9px; font-weight: 500; letter-spacing: 1px; text-transform: uppercase; color: var(--muted); padding: 10px 6px; text-align: center; background: var(--card); border-bottom: 1px solid var(--line); }
  .week-table th.today-col { color: var(--lime); }
  .week-table td { padding: 8px 6px; text-align: center; color: var(--soft); border-bottom: 1px solid var(--line); font-size: 10.5px; line-height: 1.4; vertical-align: middle; }
  .week-table tr:last-child td { border-bottom: none; }
  .week-table td:first-child { text-align: left; padding-left: 12px; font-weight: 600; color: var(--white); font-size: 11px; white-space: nowrap; }
  .week-table td.today-col { background: rgba(200,251,69,0.04); }
  .week-table .cell-on { color: var(--lime); font-weight: 600; }
  .week-table .cell-off { color: var(--rose); font-weight: 500; font-size: 10px; }
  .week-table .cell-special { color: var(--lav); font-weight: 600; }

  /* ══════════ HAIR TAB — TIMELINE ══════════ */
  .timeline { margin: 24px 28px 0; padding: 18px; border-radius: 14px; background: var(--card); border: 1px solid var(--line); }
  .timeline-title { font-family: 'JetBrains Mono', monospace; font-size: 9px; letter-spacing: 3px; text-transform: uppercase; color: var(--muted); margin-bottom: 14px; }
  .tl-row { display: flex; align-items: center; gap: 12px; padding: 8px 0; }
  .tl-row + .tl-row { border-top: 1px solid var(--line); }
  .tl-period { font-family: 'JetBrains Mono', monospace; font-size: 11px; font-weight: 500; color: var(--sky); min-width: 70px; flex-shrink: 0; }
  .tl-desc { font-size: 13px; color: var(--soft); line-height: 1.5; }
  .tl-desc strong { color: var(--white); }

  /* ══════════ HAIR TAB — BUDGET ══════════ */
  .budget-card { margin: 24px 28px 0; padding: 18px 22px; border-radius: 14px; background: var(--card); border: 1px solid var(--line); display: flex; align-items: center; justify-content: space-between; }
  .budget-label { font-family: 'JetBrains Mono', monospace; font-size: 9px; letter-spacing: 3px; text-transform: uppercase; color: var(--muted); }
  .budget-value { font-family: 'JetBrains Mono', monospace; font-size: 22px; font-weight: 500; color: var(--lime); }

/* ══════════ NOW CARD ══════════ */
.now-card {
  margin: 20px 28px 0;
  padding: 20px;
  border-radius: 16px;
  background: rgba(200,251,69,0.06);
  border: 1px solid rgba(200,251,69,0.15);
}
.now-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  font-weight: 500;
  letter-spacing: 4px;
  text-transform: uppercase;
  color: var(--lime);
  margin-bottom: 10px;
}
.now-title {
  font-size: 20px;
  font-weight: 700;
  letter-spacing: -0.3px;
  margin-bottom: 8px;
}
.now-items {
  display: grid;
  gap: 4px;
}
.now-item {
  font-size: 13.5px;
  color: var(--soft);
  line-height: 1.5;
  display: flex;
  align-items: baseline;
  gap: 8px;
}
.now-item::before {
  content: '\00b7';
  color: var(--muted);
  font-weight: 800;
  font-size: 16px;
  flex-shrink: 0;
}
.now-item-supp {
  font-size: 13px;
  font-weight: 600;
  color: var(--lime);
}
.now-item-warn {
  color: var(--rose);
  font-weight: 600;
}
.now-next {
  margin-top: 10px;
  font-size: 12px;
  color: var(--muted);
  font-style: italic;
}

/* ══════════ COLLAPSIBLE ══════════ */
.collapsible-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  padding: 20px 28px;
  border-bottom: 1px solid var(--line);
}
.collapsible-head .block-head {
  margin-bottom: 0;
  pointer-events: none;
}
.collapsible-chevron {
  color: var(--muted);
  font-size: 14px;
  transition: transform 0.25s ease;
  flex-shrink: 0;
  margin-left: 8px;
}
.collapsible-head.open .collapsible-chevron {
  transform: rotate(90deg);
}
.collapsible-body {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease;
}
.collapsible-body.open {
  max-height: 800px;
}
.collapsible-body-inner {
  padding: 0 28px 20px;
}

/* ══════════ STOCK TRACKER ══════════ */
.stock-section { margin: 24px 28px 0; }
.stock-card {
  padding: 14px 16px;
  border-radius: 12px;
  background: var(--card);
  border: 1px solid var(--line);
  margin-bottom: 8px;
}
.stock-top {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}
.stock-name {
  font-size: 13px;
  font-weight: 600;
  color: var(--white);
  flex: 1;
}
.stock-name a {
  color: var(--white);
  text-decoration: none;
}
.stock-name a:active { opacity: 0.6; }
.stock-price {
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  color: var(--muted);
  flex-shrink: 0;
}
.stock-bar-wrap {
  margin-top: 8px;
  height: 4px;
  border-radius: 2px;
  background: var(--line);
  overflow: hidden;
}
.stock-bar {
  height: 100%;
  border-radius: 2px;
  transition: width 0.3s ease;
}
.stock-bar.bar-ok { background: var(--lime); }
.stock-bar.bar-warn { background: var(--peach); }
.stock-bar.bar-low { background: var(--rose); }
.stock-bottom {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-top: 6px;
}
.stock-info {
  font-size: 11px;
  color: var(--muted);
}
.stock-info.stock-low { color: var(--rose); font-weight: 600; }
.stock-info.stock-warn { color: var(--peach); }
.stock-btn {
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  padding: 4px 10px;
  border-radius: 6px;
  border: 1px solid var(--line);
  background: transparent;
  color: var(--lime);
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
}
.stock-btn:active { opacity: 0.5; }
.stock-total {
  margin: 16px 28px 0;
  padding: 14px 18px;
  border-radius: 12px;
  background: var(--card);
  border: 1px solid var(--line);
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.stock-total-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--muted);
}
.stock-total-value {
  font-family: 'JetBrains Mono', monospace;
  font-size: 18px;
  font-weight: 500;
  color: var(--lime);
}

  @supports (padding-top: env(safe-area-inset-top)) {
    header { padding-top: calc(env(safe-area-inset-top) + 28px); }
    body { padding-bottom: calc(env(safe-area-inset-bottom) + 60px); }
  }
  ::-webkit-scrollbar { width: 0; }
</style>
</head>
<body>

<header>
  <div class="eyebrow">Protocol</div>
  <h1 id="header-title">Cut · 74 kg</h1>
  <div id="header-kpis" class="kpis">
    <div class="kpi"><b class="v-lime">2003</b><small>Kcal</small></div>
    <div class="kpi"><b>168g</b><small>Protéines</small></div>
    <div class="kpi"><b class="v-rose">-470</b><small>Déficit</small></div>
  </div>
</header>

<!-- ══════════ TABS ══════════ -->
<div class="tabs" style="margin-top: 24px;">
  <div class="tab active" data-tab="nutrition">Nutrition</div>
  <div class="tab" data-tab="cheveux">Cheveux</div>
</div>

<!-- ══════════════════════════════════════════════ -->
<!-- ══════════ TAB: NUTRITION ══════════════════════ -->
<!-- ══════════════════════════════════════════════ -->
<div id="tab-nutrition" class="tab-content active">

<div id="banner-ashwa" class="banner banner-off">
  <strong>Ashwagandha — PAUSE</strong>
  <div class="banner-sub" id="ashwa-pause-info"></div>
</div>
<div id="banner-weekend" class="banner banner-info">
  <strong>Week-end</strong> — pas de Boron aujourd'hui
</div>
<div id="banner-sunday" class="banner banner-info" style="display:none;">
  <strong>Dimanche repos</strong> — pas de banane ni flocons d'avoine
</div>

<div id="now-nutrition" class="now-card">
  <div class="now-label">Maintenant</div>
  <div class="now-title" id="now-nutri-title"></div>
  <div class="now-items" id="now-nutri-items"></div>
  <div class="now-next" id="now-nutri-next"></div>
</div>

<!-- ══════════ 4h30 — RÉVEIL ══════════ -->
<div class="collapsible-head" data-slot="preworkout">
  <div class="block-head">
    <div class="block-hour">4h30</div>
    <div class="block-title">Pré-workout</div>
  </div>
  <span class="collapsible-chevron">›</span>
</div>
<div class="collapsible-body" data-slot="preworkout">
  <div class="collapsible-body-inner">
  <div class="items" style="padding-left: 0;">
    <div class="item">Café noir</div>
    <div id="item-banane" class="item">1 banane moyenne</div>
    <div class="item">1 cuillère d'huile d'olive</div>
    <div id="supp-ashwa" class="item-supp">
      2x Ashwagandha KSM-66 (600 mg)
      <span class="supp-detail">nu3 Bio · ↓ cortisol · ↑ testo</span>
    </div>
    <div class="item-supp">
      3x Oméga 3 ESN
      <span class="supp-detail">Anti-inflammatoire · santé cardio</span>
    </div>
    <div class="item-supp">
      Vitamine D3 (4 gouttes)
      <span class="supp-detail">Immunité · santé osseuse · absorption calcium</span>
    </div>
    <div class="item-supp">
      Saw Palmetto (320 mg)
      <span class="supp-detail">↓ DHT · santé prostate · ↑ testo libre</span>
    </div>
  </div>
  <div id="macros-preworkout" class="macros" style="padding-left: 0;">
    <span class="tag t-k">225 kcal</span>
    <span class="tag t-p">1 P</span>
    <span class="tag t-g">27 G</span>
    <span class="tag t-l">14 L</span>
  </div>
  </div>
</div>

<!-- ══════════ 5h00 — TRAINING ══════════ -->
<div class="collapsible-head" data-slot="training">
  <div class="block-head">
    <div class="block-hour">5h00</div>
    <div class="block-title">Entraînement PPL</div>
  </div>
  <span class="collapsible-chevron">›</span>
</div>
<div class="collapsible-body" data-slot="training">
  <div class="collapsible-body-inner">
  <div class="items" style="padding-left: 0;">
    <div class="item">1 pastille d'électrolytes (intra)</div>
    <div class="item">1 scoop EAA (intra)</div>
  </div>
  </div>
</div>

<!-- ══════════ 6h30 — POST-WORKOUT ══════════ -->
<div class="collapsible-head" data-slot="postworkout">
  <div class="block-head">
    <div class="block-hour">~6h30</div>
    <div class="block-title">Shake post-workout</div>
  </div>
  <span class="collapsible-chevron">›</span>
</div>
<div class="collapsible-body" data-slot="postworkout">
  <div class="collapsible-body-inner">
  <div class="items" style="padding-left: 0;">
    <div class="item">1 scoop whey ON Gold Standard (30 g)</div>
    <div id="item-flocons" class="item">50 g flocons d'avoine en poudre</div>
    <div class="item">Créatine monohydrate (5 g)</div>
    <div class="item">Collagène Collamin (10 g)</div>
    <div class="item-supp">
      Vitamine C (300 mg)
      <span class="supp-detail">ESN · Immunité · antioxydant · cofacteur collagène</span>
    </div>
  </div>
  <div id="macros-postworkout" class="macros" style="padding-left: 0;">
    <span class="tag t-k">330 kcal</span>
    <span class="tag t-p">41 P</span>
    <span class="tag t-g">35 G</span>
    <span class="tag t-l">4 L</span>
  </div>
  </div>
</div>

<!-- ══════════ 12h00 — DÉJEUNER ══════════ -->
<div class="collapsible-head" data-slot="lunch">
  <div class="block-head">
    <div class="block-hour">~12h00</div>
    <div class="block-title">Déjeuner</div>
  </div>
  <span class="collapsible-chevron">›</span>
</div>
<div class="collapsible-body" data-slot="lunch">
  <div class="collapsible-body-inner">
  <div class="items" style="padding-left: 0;">
    <div class="item">200 g blanc de poulet (mariné)</div>
    <div class="item">Pas de féculent</div>
    <div class="item">200 g chou-fleur</div>
  </div>
  <div class="macros" style="padding-left: 0;">
    <span class="tag t-k">450 kcal</span>
    <span class="tag t-p">62 P</span>
    <span class="tag t-g">9 G</span>
    <span class="tag t-l">20 L</span>
  </div>
  </div>
</div>

<!-- ══════════ SNACK ══════════ -->
<div class="collapsible-head" data-slot="snack">
  <div class="block-head">
    <div class="block-hour">Flex</div>
    <div class="block-title">Snack</div>
  </div>
  <span class="collapsible-chevron">›</span>
</div>
<div class="collapsible-body" data-slot="snack">
  <div class="collapsible-body-inner">
  <div class="items" style="padding-left: 0;">
    <div class="item">2 oeufs</div>
  </div>
  <div class="macros" style="padding-left: 0;">
    <span class="tag t-k">130 kcal</span>
    <span class="tag t-p">11 P</span>
    <span class="tag t-g">1 G</span>
    <span class="tag t-l">9 L</span>
  </div>
  </div>
</div>

<!-- ══════════ 19h00 — DÎNER ══════════ -->
<div class="collapsible-head" data-slot="dinner">
  <div class="block-head">
    <div class="block-hour">~19h00</div>
    <div class="block-title">Dîner</div>
  </div>
  <span class="collapsible-chevron">›</span>
</div>
<div class="collapsible-body" data-slot="dinner">
  <div class="collapsible-body-inner">
  <div class="items" style="padding-left: 0;">
    <div class="item">200 g entrecôte (marinée)</div>
    <div class="item">60 g riz / pâtes / ebly (cru)</div>
    <div class="item">150 g légumes variés (courgettes, brocoli…)</div>
    <div id="supp-boron" class="item-supp supp-pm">
      1x Boron (6 mg)
      <span class="supp-detail">NOW Foods · ↑ testo libre · ↓ SHBG</span>
    </div>
    <div class="item-supp supp-night">
      Zinc (14 mg)
      <span class="supp-detail">↑ Testo · immunité · récup musculaire</span>
    </div>
    <div class="item-supp supp-night">
      Magnésium Glycinate (400 mg)
      <span class="supp-detail">↓ Cortisol nocturne · sommeil profond · récup</span>
    </div>
  </div>
  <div class="macros" style="padding-left: 0;">
    <span class="tag t-k">868 kcal</span>
    <span class="tag t-p">53 P</span>
    <span class="tag t-g">48 G</span>
    <span class="tag t-l">57 L</span>
  </div>
  </div>
</div>

<!-- ══════════ 22h00 ══════════ -->
<div class="collapsible-head" data-slot="sleep" style="border-bottom: none;">
  <div class="block-head">
    <div class="block-hour" style="color: var(--lav);">22h00</div>
    <div class="block-title">Sommeil · 7-8h min.</div>
  </div>
  <span class="collapsible-chevron">›</span>
</div>

<!-- ══════════ TOTAUX ══════════ -->
<div class="totals">
  <div><div class="tval c1">2003</div><div class="tlbl">Kcal</div></div>
  <div><div class="tval c2">168g</div><div class="tlbl">Prot</div><div class="tcheck">2.27g/kg</div></div>
  <div><div class="tval c3">120g</div><div class="tlbl">Gluc</div></div>
  <div><div class="tval c4">104g</div><div class="tlbl">Lip</div><div class="tcheck">1.4g/kg</div></div>
</div>

<!-- ══════════ CYCLES ══════════ -->
<div class="cycle-status">
  <div class="cycle-title">Statut des cycles</div>
  <div class="cycle-row">
    <div>
      <div class="cycle-name">Ashwagandha</div>
      <div class="cycle-detail" id="ashwa-cycle-detail">8 sem. ON / 2 sem. OFF</div>
    </div>
    <div class="cycle-badge" id="ashwa-badge">—</div>
  </div>
  <div class="cycle-row">
    <div>
      <div class="cycle-name">Boron</div>
      <div class="cycle-detail" id="boron-cycle-detail">Lundi → Vendredi</div>
    </div>
    <div class="cycle-badge" id="boron-badge">—</div>
  </div>
  <div class="cycle-row">
    <div>
      <div class="cycle-name">Créatine / Oméga 3 / Vit C / Vit D3 / Saw Palmetto / EAA / Zn / Mg / Collagène</div>
      <div class="cycle-detail">Continu — pas de cycle</div>
    </div>
    <div class="cycle-badge cb-on">ON</div>
  </div>
</div>

<!-- ══════════ SHOP & STOCK ══════════ -->
<div class="notes-head">Shop & Stock</div>
<div class="stock-section" id="stock-nutrition"></div>
<div class="stock-total">
  <div class="stock-total-label">Coût mensuel nutrition</div>
  <div class="stock-total-value" id="cost-nutrition">–</div>
</div>

<!-- ══════════ NOTES ══════════ -->
<div class="notes-head">Notes</div>

<div class="note">
  <strong>Objectif</strong> — 74 kg / 14.5% BF → <b>70.3 kg / 10% BF en ~10 semaines</b>. 3.7 kg de gras à perdre. Déficit 470 kcal = ~0.4 kg/semaine.
</div>
<div class="note">
  <strong>Lipides 104 g/jour (1.4 g/kg)</strong> — largement au-dessus du seuil testo. Pas de risque de chute hormonale.
</div>
<div class="note">
  <strong>Ashwagandha</strong> — cycle <b>8 sem. ON / 2 sem. OFF</b>. Évite la tolérance et protège la thyroïde.
</div>
<div class="note">
  <strong>Boron 6 mg</strong> — <b>lun → ven uniquement</b>. Dose efficace ↓ SHBG. Pause week-end.
</div>
<div class="note">
  <strong>Zinc 14 mg</strong> — soutien testo + immunité. Synergie avec le magnésium (combo ZMA). Continu.
</div>
<div class="note">
  <strong>Magnésium Glycinate 400 mg</strong> — ↓ cortisol nocturne, ↑ sommeil profond, ↓ rétention d'eau. Continu.
</div>
<div class="note">
  <strong>Collagène Collamin 10 g</strong> — dans le shake post-workout. Tendons, articulations, récup. Protéine incomplète (pas de tryptophane), complète la whey mais ne la remplace pas. Continu.
</div>
<div class="note">
  <strong>Créatine</strong> — <b>5 g/jour continu</b>. Post-workout avec glucides. +1-2 kg rétention intramusculaire (pas sous-cutanée).
</div>
<div class="note">
  <strong>Hydratation</strong> — min. <b>3 L/jour</b>. Créatine + cut + training matinal = besoins augmentés.
</div>

<!-- ══════════ SETTINGS ══════════ -->
<button class="settings-toggle" onclick="toggleSettings()">Réglage du cycle Ashwagandha</button>
<div id="settings" class="settings-panel">
  <label for="start-date">Date de début du cycle actuel :</label>
  <div class="hint">Quand as-tu commencé (ou repris) l'ashwagandha ? La page calcule automatiquement quand faire la pause.</div>
  <input type="date" id="start-date">
  <button class="btn-save" onclick="saveStartDate()">Sauvegarder</button>
</div>

</div><!-- /tab-nutrition -->

<!-- ══════════════════════════════════════════════ -->
<!-- ══════════ TAB: CHEVEUX ═══════════════════════ -->
<!-- ══════════════════════════════════════════════ -->
<div id="tab-cheveux" class="tab-content">

<div id="banner-hair-day" class="banner banner-sky"></div>

<div id="now-hair" class="now-card" style="border-color: rgba(108,180,255,0.15); background: rgba(108,180,255,0.05);">
  <div class="now-label" style="color: var(--sky);">Maintenant</div>
  <div class="now-title" id="now-hair-title"></div>
  <div class="now-items" id="now-hair-items"></div>
  <div class="now-next" id="now-hair-next"></div>
</div>

<!-- ══════════ ~7h00 — DUCRAY ANAPHASE+ ══════════ -->
<div class="collapsible-head" data-slot="shower">
  <div class="block-head">
    <div class="block-hour">~7h00</div>
    <div class="block-title">Ducray Anaphase+</div>
  </div>
  <span class="collapsible-chevron">›</span>
</div>
<div class="collapsible-body" data-slot="shower">
  <div class="collapsible-body-inner">
  <div class="items" style="padding-left: 0;">
    <div class="item">Shampoing doux sans SLS — après l'entraînement</div>
    <div class="item">Tous les matins</div>
  </div>
  </div>
</div>

<!-- ══════════ SOIR — NIZORAL 2% ══════════ -->
<div class="collapsible-head" data-slot="nizoral">
  <div class="block-head">
    <div class="block-hour" style="color: var(--lav);">Soir</div>
    <div class="block-title">Nizoral 2% · Mar/Jeu/Sam</div>
  </div>
  <span class="collapsible-chevron">›</span>
</div>
<div class="collapsible-body" data-slot="nizoral">
  <div class="collapsible-body-inner">
  <div class="items" style="padding-left: 0;" id="hair-nizoral-items">
    <div class="item">Chargement…</div>
  </div>
  </div>
</div>

<!-- ══════════ SOIR — MINOXIDIL 5% ══════════ -->
<div class="collapsible-head" data-slot="minoxidil">
  <div class="block-head">
    <div class="block-hour" style="color: var(--lav);">Soir</div>
    <div class="block-title">Minoxidil 5%</div>
  </div>
  <span class="collapsible-chevron">›</span>
</div>
<div class="collapsible-body" data-slot="minoxidil">
  <div class="collapsible-body-inner">
  <div class="items" style="padding-left: 0;" id="hair-minox-items">
    <div class="item">Chargement…</div>
  </div>
  </div>
</div>

<!-- ══════════ DIMANCHE SOIR — MICRONEEDLING ══════════ -->
<div class="collapsible-head" data-slot="needling">
  <div class="block-head">
    <div class="block-hour" style="color: var(--lav);">Dim.</div>
    <div class="block-title">Microneedling</div>
  </div>
  <span class="collapsible-chevron">›</span>
</div>
<div class="collapsible-body" data-slot="needling" id="hair-needling-block">
  <div class="collapsible-body-inner">
  <div class="items-flat" style="padding-left: 0;">
    <div class="item">Cuir chevelu propre et sec</div>
    <div class="item">Stériliser dermaroller 1,0 mm à l'alcool isopropylique 70%</div>
    <div class="item">Rouler pression légère sur zones de recul</div>
    <div class="item">4-6 passes par direction : horizontale, verticale, diagonale gauche, diagonale droite</div>
    <div class="item">Viser rougeur uniforme, pas de saignement franc</div>
    <div class="item">Stériliser à nouveau le roller, ranger dans son étui</div>
    <div class="item item-warn"><strong>PAS</strong> de minoxidil ce soir</div>
    <div class="item">Reprendre le minoxidil demain soir (lundi)</div>
  </div>
  </div>
</div>

<!-- ══════════ SEMAINE TYPE ══════════ -->
<div class="notes-head">Semaine type</div>
<div class="week-table">
  <table>
    <thead>
      <tr>
        <th></th>
        <th data-dow="1">Lun</th>
        <th data-dow="2">Mar</th>
        <th data-dow="3">Mer</th>
        <th data-dow="4">Jeu</th>
        <th data-dow="5">Ven</th>
        <th data-dow="6">Sam</th>
        <th data-dow="0">Dim</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Ducray (matin)</td>
        <td data-dow="1" class="cell-on">Oui</td>
        <td data-dow="2" class="cell-on">Oui</td>
        <td data-dow="3" class="cell-on">Oui</td>
        <td data-dow="4" class="cell-on">Oui</td>
        <td data-dow="5" class="cell-on">Oui</td>
        <td data-dow="6" class="cell-on">Oui</td>
        <td data-dow="0" class="cell-on">Oui</td>
      </tr>
      <tr>
        <td>Nizoral 2% (soir)</td>
        <td data-dow="1">—</td>
        <td data-dow="2" class="cell-special">Oui</td>
        <td data-dow="3">—</td>
        <td data-dow="4" class="cell-special">Oui</td>
        <td data-dow="5">—</td>
        <td data-dow="6" class="cell-special">Oui</td>
        <td data-dow="0">—</td>
      </tr>
      <tr>
        <td>Minoxidil (soir)</td>
        <td data-dow="1" class="cell-on">Oui</td>
        <td data-dow="2" class="cell-on">Oui</td>
        <td data-dow="3" class="cell-on">Oui</td>
        <td data-dow="4" class="cell-on">Oui</td>
        <td data-dow="5" class="cell-on">Oui</td>
        <td data-dow="6" class="cell-on">Oui</td>
        <td data-dow="0" class="cell-off">Non</td>
      </tr>
      <tr>
        <td>Needling</td>
        <td data-dow="1">—</td>
        <td data-dow="2">—</td>
        <td data-dow="3">—</td>
        <td data-dow="4">—</td>
        <td data-dow="5">—</td>
        <td data-dow="6">—</td>
        <td data-dow="0" class="cell-special">Oui</td>
      </tr>
    </tbody>
  </table>
</div>

<!-- ══════════ ENTRETIEN ══════════ -->
<div class="notes-head">Entretien matériel</div>
<div class="note">
  <strong>Dermaroller</strong> — remplacer toutes les <b>6-8 utilisations</b> (~toutes les 6-8 semaines)
</div>
<div class="note">
  <strong>Alcool isopropylique</strong> — stériliser le roller <b>avant ET après</b> chaque séance
</div>

<!-- ══════════ SUIVI ══════════ -->
<div class="notes-head">Suivi</div>
<div class="note">
  <strong>Photos mensuelles</strong> — même lumière, même angle, cheveux mouillés tirés en arrière. <b>Front, golfes G/D, vertex.</b>
</div>
<div class="note">
  <strong>Dosage sanguin Vitamine D</strong> — à faire dès que possible. Objectif <b>>75 nmol/L</b>.
</div>
<div class="note">
  <strong>Réévaluation à 6 mois</strong> — comparer photos mois 1 vs mois 6.
</div>

<!-- ══════════ TIMELINE ══════════ -->
<div class="timeline">
  <div class="timeline-title">Timeline attendue</div>
  <div class="tl-row">
    <div class="tl-period">Sem. 2-8</div>
    <div class="tl-desc"><strong>Shedding</strong> — chute temporaire accélérée. Bon signe, les follicules redémarrent.</div>
  </div>
  <div class="tl-row">
    <div class="tl-period">Mois 3-4</div>
    <div class="tl-desc"><strong>Premiers signes</strong> d'amélioration visibles.</div>
  </div>
  <div class="tl-row">
    <div class="tl-period">Mois 6-12</div>
    <div class="tl-desc"><strong>Résultats optimaux.</strong></div>
  </div>
</div>

<!-- ══════════ ALERTES ══════════ -->
<div class="notes-head">Alertes</div>
<div class="note" style="border-color: var(--off-border);">
  <strong style="color: var(--rose);">Irritation sévère / démangeaisons</strong> — réduire fréquence Nizoral ou minoxidil.
</div>
<div class="note" style="border-color: var(--off-border);">
  <strong style="color: var(--rose);">Saignement abondant au microneedling</strong> — tu appuies trop fort.
</div>
<div class="note" style="border-color: var(--off-border);">
  <strong style="color: var(--rose);">Zéro changement après 6 mois</strong> — RDV dermato pour passer au Tier 3 (finastéride topique).
</div>

<!-- ══════════ SHOP & STOCK ══════════ -->
<div class="notes-head">Shop & Stock</div>
<div class="stock-section" id="stock-hair"></div>
<div class="stock-total">
  <div class="stock-total-label">Coût mensuel cheveux</div>
  <div class="stock-total-value" id="cost-hair">–</div>
</div>

<div class="note" style="margin-top: 24px; border-color: rgba(200,251,69,0.15); background: var(--lime10);">
  <strong style="color: var(--lime);">La règle d'or</strong> — tiens ce protocole <b>sans exception pendant 6 mois</b>. La régularité c'est 80% du résultat.
</div>

</div><!-- /tab-cheveux -->

<script>
(function() {
  // ══════════ TABS ══════════
  var tabs = document.querySelectorAll('.tab');
  var contents = document.querySelectorAll('.tab-content');
  var headerTitle = document.getElementById('header-title');
  var headerKpis = document.getElementById('header-kpis');

  var headerData = {
    nutrition: { title: 'Cut · 74 kg', kpis: '<div class="kpi"><b class="v-lime">2003</b><small>Kcal</small></div><div class="kpi"><b>168g</b><small>Protéines</small></div><div class="kpi"><b class="v-rose">-470</b><small>Déficit</small></div>' },
    cheveux: { title: 'Hair Protocol', kpis: '<div class="kpi"><b class="v-sky">6</b><small>Mois</small></div><div class="kpi"><b class="v-peach">~90</b><small>CHF/mois</small></div><div class="kpi"><b class="v-lav">1x</b><small>Needling/sem</small></div>' }
  };

  tabs.forEach(function(tab) {
    tab.addEventListener('click', function() {
      var target = this.getAttribute('data-tab');
      tabs.forEach(function(t) { t.classList.remove('active'); });
      contents.forEach(function(c) { c.classList.remove('active'); });
      this.classList.add('active');
      document.getElementById('tab-' + target).classList.add('active');
      headerTitle.textContent = headerData[target].title;
      headerKpis.innerHTML = headerData[target].kpis;
    });
  });

  // ══════════ NUTRITION — ASHWAGANDHA CYCLE ══════════
  var ASHWA_ON = 56, ASHWA_OFF = 14, CYCLE = 70;
  var today = new Date();
  var dow = today.getDay();
  var isWE = (dow === 0 || dow === 6);

  var boronEl = document.getElementById('supp-boron');
  var boronBadge = document.getElementById('boron-badge');
  var bannerWE = document.getElementById('banner-weekend');
  if (isWE) {
    boronEl.classList.add('supp-hidden');
    boronBadge.textContent = 'OFF';
    boronBadge.className = 'cycle-badge cb-off';
    bannerWE.classList.add('show');
    document.getElementById('boron-cycle-detail').textContent = 'Reprise lundi';
  } else {
    boronBadge.textContent = 'ON';
    boronBadge.className = 'cycle-badge cb-on';
  }

  // Dimanche repos : pas de banane ni flocons d'avoine
  var isSundayRest = (dow === 0);
  if (isSundayRest) {
    var bananeEl = document.getElementById('item-banane');
    var floconsEl = document.getElementById('item-flocons');
    if (bananeEl) bananeEl.classList.add('supp-hidden');
    if (floconsEl) floconsEl.classList.add('supp-hidden');
    document.getElementById('banner-sunday').classList.add('show');
    // Macros dimanche : sans banane (-100kcal, -1P, -27G) et sans flocons (-180kcal, -6P, -35G, -3L)
    document.getElementById('macros-preworkout').innerHTML = '<span class="tag t-k">125 kcal</span><span class="tag t-p">0 P</span><span class="tag t-g">0 G</span><span class="tag t-l">14 L</span>';
    document.getElementById('macros-postworkout').innerHTML = '<span class="tag t-k">150 kcal</span><span class="tag t-p">35 P</span><span class="tag t-g">0 G</span><span class="tag t-l">1 L</span>';
  }

  var stored = localStorage.getItem('ashwa_start');
  var startInput = document.getElementById('start-date');
  if (stored) {
    startInput.value = stored;
    runAshwa(new Date(stored));
  } else {
    var s = today.toISOString().split('T')[0];
    startInput.value = s;
    localStorage.setItem('ashwa_start', s);
    runAshwa(today);
  }

  function runAshwa(start) {
    var diff = Math.floor((today - start) / 864e5);
    var day = ((diff % CYCLE) + CYCLE) % CYCLE;
    var el = document.getElementById('supp-ashwa');
    var badge = document.getElementById('ashwa-badge');
    var banner = document.getElementById('banner-ashwa');
    var detail = document.getElementById('ashwa-cycle-detail');
    var info = document.getElementById('ashwa-pause-info');
    if (day < ASHWA_ON) {
      var rem = ASHWA_ON - day, wk = Math.floor(day / 7) + 1;
      badge.textContent = 'ON'; badge.className = 'cycle-badge cb-on';
      detail.textContent = 'Semaine ' + wk + '/8 · encore ' + rem + 'j avant pause';
      el.classList.remove('supp-hidden');
    } else {
      var rem2 = CYCLE - day, wk2 = Math.floor((day - ASHWA_ON) / 7) + 1;
      badge.textContent = 'OFF'; badge.className = 'cycle-badge cb-off';
      detail.textContent = 'Pause sem. ' + wk2 + '/2 · reprise dans ' + rem2 + 'j';
      el.classList.add('supp-hidden');
      banner.classList.add('show');
      info.textContent = 'Pause semaine ' + wk2 + '/2 — reprise dans ' + rem2 + ' jours.';
    }
  }

  window.toggleSettings = function() { document.getElementById('settings').classList.toggle('show'); };
  window.saveStartDate = function() {
    var v = document.getElementById('start-date').value;
    if (v) { localStorage.setItem('ashwa_start', v); runAshwa(new Date(v)); document.getElementById('settings').classList.remove('show'); }
  };

  // ══════════ NUTRITION — NOW CARD ══════════
  var hour = today.getHours();

  // Store ashwa status for Now Card (need to check if supp-ashwa is hidden)
  var ashwaIsOn = !document.getElementById('supp-ashwa').classList.contains('supp-hidden');

  var nutriSlots = [
    { start: 4, end: 4, id: 'preworkout', title: 'Pré-workout', items: isSundayRest ? ['Café noir', "1 cuillère d'huile d'olive"] : ['Café noir', '1 banane moyenne', "1 cuillère d'huile d'olive"], supps: [], next: 'Prochain : entraînement à 5h00' },
    { start: 5, end: 5, id: 'training', title: 'Entraînement PPL', items: ["1 pastille d'électrolytes", '1 scoop EAA'], supps: [], next: 'Prochain : shake post-workout ~6h30' },
    { start: 6, end: 11, id: 'postworkout', title: 'Shake post-workout', items: isSundayRest ? ['1 scoop whey ON Gold Standard (30g)', 'Créatine monohydrate (5g)', 'Collagène Collamin (10g)'] : ['1 scoop whey ON Gold Standard (30g)', "50g flocons d'avoine en poudre", 'Créatine monohydrate (5g)', 'Collagène Collamin (10g)'], supps: ['Vitamine C 300mg'], next: 'Prochain : déjeuner vers 12h00' },
    { start: 12, end: 14, id: 'lunch', title: 'Déjeuner', items: ['200g blanc de poulet (mariné)', 'Pas de féculent', '200g chou-fleur'], supps: [], next: 'Prochain : snack' },
    { start: 15, end: 18, id: 'snack', title: 'Snack', items: ['2 oeufs'], supps: [], next: 'Prochain : dîner vers 19h00' },
    { start: 19, end: 21, id: 'dinner', title: 'Dîner', items: ['200g entrecôte (marinée)', '60g riz / pâtes / ebly (cru)', '150g légumes variés'], supps: ['Zinc 14mg', 'Magnésium Glycinate 400mg'], next: 'Prochain : sommeil à 22h00' },
    { start: 22, end: 3, id: 'sleep', title: 'Sommeil · 7-8h min', items: [], supps: [], next: '' }
  ];

  // Add dynamic supps
  nutriSlots[0].supps = [
    ashwaIsOn ? 'Ashwagandha KSM-66 600mg' : null,
    'Oméga 3 ESN x3',
    'Vitamine D3 (4 gouttes)',
    'Saw Palmetto 320mg'
  ].filter(Boolean);

  if (!isWE) nutriSlots[5].supps.unshift('Boron 6mg');

  function getNutriSlot(h) {
    for (var i = 0; i < nutriSlots.length; i++) {
      var s = nutriSlots[i];
      if (s.start <= s.end) {
        if (h >= s.start && h <= s.end) return s;
      } else {
        if (h >= s.start || h <= s.end) return s;
      }
    }
    return nutriSlots[nutriSlots.length - 1];
  }

  var currentNutriSlot = getNutriSlot(hour);

  var nutriTitle = document.getElementById('now-nutri-title');
  var nutriItems = document.getElementById('now-nutri-items');
  var nutriNext = document.getElementById('now-nutri-next');

  nutriTitle.textContent = currentNutriSlot.title;

  var html = '';
  currentNutriSlot.items.forEach(function(item) {
    html += '<div class="now-item">' + item + '</div>';
  });
  currentNutriSlot.supps.forEach(function(supp) {
    html += '<div class="now-item now-item-supp">' + supp + '</div>';
  });
  nutriItems.innerHTML = html;

  if (currentNutriSlot.next) {
    nutriNext.textContent = currentNutriSlot.next;
  } else {
    nutriNext.style.display = 'none';
  }

  window.currentNutriSlot = currentNutriSlot;
  window.currentHour = hour;

  // ══════════ NUTRITION — COLLAPSIBLE TOGGLE ══════════
  document.querySelectorAll('#tab-nutrition .collapsible-head').forEach(function(head) {
    head.addEventListener('click', function() {
      var slot = this.getAttribute('data-slot');
      var body = document.querySelector('#tab-nutrition .collapsible-body[data-slot="' + slot + '"]');
      this.classList.toggle('open');
      if (body) body.classList.toggle('open');
    });
  });

  // Auto-open current nutrition slot
  if (window.currentNutriSlot) {
    var curHead = document.querySelector('#tab-nutrition .collapsible-head[data-slot="' + window.currentNutriSlot.id + '"]');
    var curBody = document.querySelector('#tab-nutrition .collapsible-body[data-slot="' + window.currentNutriSlot.id + '"]');
    if (curHead) curHead.classList.add('open');
    if (curBody) curBody.classList.add('open');
  }

  // ══════════ CHEVEUX — DYNAMIC DAY ══════════
  var dayNames = ['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'];
  var isNizoralEvening = (dow === 2 || dow === 4 || dow === 6); // Mar/Jeu/Sam soir
  var isSunday = (dow === 0);
  var minoxTonight = !isSunday; // Tous les soirs sauf dimanche

  var bannerHair = document.getElementById('banner-hair-day');
  var minoxItems = document.getElementById('hair-minox-items');
  var nizoralItems = document.getElementById('hair-nizoral-items');

  // Banner
  var bannerParts = [];
  if (isNizoralEvening) bannerParts.push('Nizoral 2% ce soir');
  if (isSunday) bannerParts.push('Microneedling ce soir · pas de minoxidil');
  if (bannerParts.length > 0) {
    bannerHair.innerHTML = '<strong>' + dayNames[dow] + '</strong> — ' + bannerParts.join(' · ');
    bannerHair.classList.add('show');
  }

  // Nizoral evening section
  if (nizoralItems) {
    if (isNizoralEvening) {
      nizoralItems.innerHTML =
        '<div class="item">Douche avec Nizoral 2% — poser 3-5 min, rincer</div>' +
        '<div class="item">Sécher les cheveux</div>' +
        '<div class="item">Puis appliquer le minoxidil</div>';
    } else {
      var nextNiz = dow < 2 ? 'mardi' : dow < 4 ? 'jeudi' : dow < 6 ? 'samedi' : 'mardi';
      nizoralItems.innerHTML =
        '<div class="item" style="color: var(--muted);">Pas de Nizoral aujourd\'hui — prochain : ' + nextNiz + ' soir</div>';
    }
  }

  // Minoxidil
  if (minoxTonight) {
    minoxItems.innerHTML =
      '<div class="item">Mousse Regaine 5% sur golfes et zones de recul</div>' +
      '<div class="item">Cheveux secs · 1 noisette · masser 1 min</div>' +
      '<div class="item">Laisser sécher 10-15 min · ne pas rincer · dormir avec</div>';
  } else {
    // Sunday
    minoxItems.innerHTML =
      '<div class="item item-warn"><strong>PAS</strong> de minoxidil ce soir — jour de microneedling</div>' +
      '<div class="item">Reprendre demain soir (lundi)</div>';
  }

  // Highlight today in weekly table
  var todayCells = document.querySelectorAll('[data-dow="' + dow + '"]');
  todayCells.forEach(function(cell) { cell.classList.add('today-col'); });

  // ══════════ CHEVEUX — NOW CARD ══════════

  function renderNowHair() {
    var title = document.getElementById('now-hair-title');
    var items = document.getElementById('now-hair-items');
    var next = document.getElementById('now-hair-next');
    var html = '';
    var slotId = '';

    var eveningInfo = isSunday ? 'Microneedling (pas de minoxidil)' :
      isNizoralEvening ? 'Nizoral 2% + Minoxidil' : 'Minoxidil';

    if (hour >= 4 && hour <= 7) {
      // Morning: Ducray shower after training
      slotId = 'shower';
      title.textContent = 'Ducray Anaphase+';
      html = '<div class="now-item">Shampoing doux sans SLS — après l\'entraînement</div>';
      next.textContent = 'Ce soir : ' + eveningInfo;
    } else if (hour >= 8 && hour <= 20) {
      // Idle
      slotId = 'idle';
      title.textContent = 'Rien pour le moment';
      next.textContent = 'Ce soir : ' + eveningInfo;
    } else {
      // Evening / night (21-3)
      if (isSunday) {
        slotId = 'needling';
        title.textContent = 'Microneedling';
        html = '<div class="now-item">Cuir chevelu propre et sec</div>';
        html += '<div class="now-item">Stériliser dermaroller 1,0 mm (alcool 70%)</div>';
        html += '<div class="now-item">Rouler pression légère — 4-6 passes par direction</div>';
        html += '<div class="now-item">Viser rougeur uniforme, pas de saignement</div>';
        html += '<div class="now-item">Stériliser à nouveau, ranger</div>';
        html += '<div class="now-item now-item-warn">PAS de minoxidil ce soir</div>';
        next.textContent = 'Reprendre le minoxidil demain soir (lundi)';
      } else if (isNizoralEvening) {
        slotId = 'nizoral';
        title.textContent = 'Nizoral 2% + Minoxidil';
        html = '<div class="now-item">Douche Nizoral 2% — poser 3-5 min, rincer</div>';
        html += '<div class="now-item">Sécher les cheveux</div>';
        html += '<div class="now-item now-item-supp">Puis : Minoxidil 5% mousse sur golfes</div>';
        html += '<div class="now-item">Cheveux secs · 1 noisette · masser 1 min</div>';
        html += '<div class="now-item">Sécher 10-15 min · ne pas rincer · dormir avec</div>';
        next.textContent = '';
        next.style.display = 'none';
      } else {
        slotId = 'minoxidil';
        title.textContent = 'Minoxidil 5%';
        html = '<div class="now-item">Mousse Regaine sur golfes et zones de recul</div>';
        html += '<div class="now-item">Cheveux secs · 1 noisette · masser 1 min</div>';
        html += '<div class="now-item">Sécher 10-15 min · ne pas rincer · dormir avec</div>';
        next.textContent = '';
        next.style.display = 'none';
      }
    }

    items.innerHTML = html;
    window.currentHairSlot = slotId;
  }

  renderNowHair();

  // ══════════ CHEVEUX — COLLAPSIBLE TOGGLE ══════════
  document.querySelectorAll('#tab-cheveux .collapsible-head').forEach(function(head) {
    head.addEventListener('click', function() {
      var slot = this.getAttribute('data-slot');
      var body = document.querySelector('#tab-cheveux .collapsible-body[data-slot="' + slot + '"]');
      this.classList.toggle('open');
      if (body) body.classList.toggle('open');
    });
  });

  // Auto-open current hair slot
  if (window.currentHairSlot) {
    var curHairHead = document.querySelector('#tab-cheveux .collapsible-head[data-slot="' + window.currentHairSlot + '"]');
    var curHairBody = document.querySelector('#tab-cheveux .collapsible-body[data-slot="' + window.currentHairSlot + '"]');
    if (curHairHead) curHairHead.classList.add('open');
    if (curHairBody) curHairBody.classList.add('open');
  }

  // ══════════ STOCK TRACKER ══════════
  var products = {
    nutrition: [
      { id: 'ashwa', name: 'Ashwagandha KSM-66', url: 'https://www.fr.nu3.ch/products/nu3-ashwagandha-bio', price: 27.95, units: 120, perDay: 2, unit: 'caps', note: 'Cycle 8/2 sem' },
      { id: 'omega3', name: 'ESN Oméga 3', url: 'https://www.galaxus.ch/fr/s6/product/esn-omega-3-300-pcs-capsules-420-g-vitamines-complements-alimentaires-16628663', price: 67.20, units: 300, perDay: 3, unit: 'caps' },
      { id: 'vitd', name: 'Vitamine D3', url: 'https://www.galaxus.ch/fr/s6/product/pure-encapsulations-vitamine-d3-1-pcs-gouttes-vitamines-complements-alimentaires-17543276', price: 16.90, units: 180, perDay: 1, unit: 'doses', note: '4 gouttes = 1 dose' },
      { id: 'sawpalm', name: 'Saw Palmetto 320mg', url: 'https://makeup.ch/product/499525/', price: 27.90, units: 90, perDay: 1, unit: 'caps' },
      { id: 'vitc', name: 'Vitamine C', url: 'https://www.galaxus.ch/fr/s6/product/pure-encapsulations-vitamine-c-90-pcs-capsules-vitamines-complements-alimentaires-15755978', price: 25.90, units: 90, perDay: 2, unit: 'caps' },
      { id: 'zinc', name: 'Zinc Burgerstein', url: 'https://www.galaxus.ch/fr/s6/product/burgerstein-zinc-vital-100-pcs-cachets-40-g-vitamines-complements-alimentaires-723650', price: 35.00, units: 100, perDay: 1, unit: 'caps' },
      { id: 'mag', name: 'Magnésium Glycinate', url: 'https://www.galaxus.ch/fr/s6/product/pure-encapsulations-gelule-de-glycinate-de-magnesium-180-pcs-capsules-262-g-vitamines-complements-al-15755969', price: 61.90, units: 180, perDay: 2, unit: 'caps' },
      { id: 'boron', name: 'Boron 3mg NOW Foods', url: 'https://makeup.ch/product/485368/', price: 15.00, units: 250, perDay: 1.43, unit: 'caps', note: '2/j, 5j/7' },
      { id: 'creatine', name: 'Créatine ON', url: 'https://www.galaxus.ch/fr/s6/product/optimum-nutrition-creatine-powder-1-pcs-poudre-317-g-vitamines-complements-alimentaires-6349485', price: 35.70, units: 127, perDay: 1, unit: 'portions' },
      { id: 'collagen', name: 'Collamin Collagène', url: 'https://www.galaxus.ch/fr/s6/product/collamin-naturactive-collagene-peptide-poudre-450-g-vitamines-complements-alimentaires-21411362', price: 35.00, units: 45, perDay: 1, unit: 'portions' },
      { id: 'whey', name: 'Whey Gold Standard', url: 'https://www.galaxus.ch/fr/s7/product/optimum-nutrition-100-whey-gold-standard-double-rich-chocolate-1-x-2260-g-poudre-de-proteine-16011663', price: 72.90, units: 75, perDay: 1, unit: 'portions' },
      { id: 'eaa', name: 'EAA Body Attack', url: 'https://www.galaxus.ch/fr/s7/product/body-attack-extreme-instant-eaa-citron-1-x-500-g-poudre-de-proteine-11227437', price: 43.00, units: 50, perDay: 1, unit: 'portions' },
      { id: 'electro', name: 'Sponser Electrolytes', url: 'https://www.galaxus.ch/fr/s7/product/sponser-electrolytes-citron-1-x-boisson-pour-le-sport-9854623', price: 5.30, units: 10, perDay: 0.86, unit: 'pastilles', note: '6x/sem (training)' }
    ],
    hair: [
      { id: 'regaine', name: 'Regaine 5% mousse', url: 'https://www.vitadrogerie.ch/fr/regaine-schaum-5-manner-3-x-60ml.html', price: 140.00, units: 90, perDay: 0.71, unit: 'jours', note: '~5j/7' },
      { id: 'nizoral', name: 'Nizoral 2%', url: 'https://www.fruugoschweiz.com/shampooing-nizoral-shampooing-antipelliculaire-shampooing-doux-et-lisse-pour-cheveux-nettoie-en-profondeur/p-443048985-930103070?language=fr', price: 25.95, units: 90, perDay: 0.43, unit: 'jours', note: '3x/sem soir' },
      { id: 'ducray', name: 'Ducray Anaphase+', url: 'https://www.coopvitality.ch/de/p/ducray-anaphase-chronic-shampoo-bei-haarausfall-tb-200-ml-1003886', price: 22.90, units: 90, perDay: 1, unit: 'jours', note: 'Tous les matins' },
      { id: 'roller', name: 'Dermaroller 1.0mm', url: 'https://www.stayhealthy.ch/derma-roller-mikro-nadelroller', price: 24.50, units: 7, perDay: 0.14, unit: 'utilisations', note: 'Remplacer toutes les 7 utilisations' },
      { id: 'alcool', name: 'Alcool isopropylique 1L', url: 'https://www.galaxus.ch/fr/s6/product/haenseler-alcool-isopropylique-70-1000-ml-desinfectant-58151271', price: 12.00, units: 365, perDay: 0.14, unit: 'jours', note: '~1 an' }
    ]
  };

  function renderStock(tab) {
    var container = document.getElementById('stock-' + tab);
    var items = products[tab];
    var totalMonthly = 0;
    var html = '';

    items.forEach(function(p) {
      var storageKey = 'stock_' + p.id;
      var stored = JSON.parse(localStorage.getItem(storageKey) || 'null');
      var daysTotal = Math.floor(p.units / p.perDay);
      var monthlyPrice = (p.price / daysTotal) * 30;
      totalMonthly += monthlyPrice;

      var daysLeft = daysTotal;
      var pct = 100;
      var statusText = 'Tap "Racheté" pour commencer le suivi';
      var statusClass = '';
      var barClass = 'bar-ok';

      if (stored) {
        var elapsed = Math.floor((Date.now() - stored.date) / 864e5);
        var used = Math.floor(elapsed * p.perDay);
        var remaining = Math.max(0, stored.qty - used);
        daysLeft = Math.max(0, Math.floor(remaining / p.perDay));
        pct = Math.min(100, Math.max(0, Math.floor((remaining / p.units) * 100)));

        if (daysLeft <= 0) {
          statusText = 'Épuisé — racheter !';
          statusClass = 'stock-low';
          barClass = 'bar-low';
        } else if (daysLeft <= 7) {
          statusText = daysLeft + 'j restants — commander bientôt';
          statusClass = 'stock-low';
          barClass = 'bar-low';
        } else if (daysLeft <= 14) {
          statusText = daysLeft + 'j restants';
          statusClass = 'stock-warn';
          barClass = 'bar-warn';
        } else {
          statusText = daysLeft + 'j restants (~' + Math.floor(daysLeft / 7) + ' sem)';
          statusClass = '';
          barClass = 'bar-ok';
        }
      }

      html += '<div class="stock-card" data-product="' + p.id + '">';
      html += '<div class="stock-top">';
      html += '<div class="stock-name"><a href="' + p.url + '" target="_blank">' + p.name + ' →</a></div>';
      html += '<div class="stock-price">' + p.price.toFixed(2) + ' CHF</div>';
      html += '</div>';
      html += '<div class="stock-bar-wrap"><div class="stock-bar ' + barClass + '" style="width:' + pct + '%"></div></div>';
      html += '<div class="stock-bottom">';
      html += '<div class="stock-info ' + statusClass + '">' + statusText + '</div>';
      html += '<button class="stock-btn" onclick="stockRefill(\'' + p.id + '\',\'' + tab + '\',' + p.units + ')">Racheté</button>';
      html += '</div>';
      html += '</div>';
    });

    container.innerHTML = html;
    document.getElementById('cost-' + tab).textContent = '~' + Math.round(totalMonthly) + ' CHF';
  }

  window.stockRefill = function(id, tab, units) {
    var storageKey = 'stock_' + id;
    localStorage.setItem(storageKey, JSON.stringify({ date: Date.now(), qty: units }));
    renderStock(tab);
  };

  renderStock('nutrition');
  renderStock('hair');
})();
</script>
</body>
</html>
